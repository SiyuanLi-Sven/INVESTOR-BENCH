# INVESTOR-BENCH 项目概览

## 🎯 项目简介

INVESTOR-BENCH 是一个基于大语言模型（LLM）的投资决策评估框架，用于评测智能体在金融投资场景中的表现。项目实现了FinMemAgent（金融记忆智能体），具备多层级记忆系统和专业的投资决策能力。

## 🏗️ 核心架构

### FinMemAgent (金融记忆智能体)
- **多层级记忆系统**: 短期、中期、长期、反思记忆
- **向量数据库**: 使用Qdrant进行记忆存储和检索
- **角色专业化**: 针对不同股票（如JNJ、AAPL等）的专业投资知识
- **决策推理**: 基于历史记忆和市场信息的投资决策

### MarketEnv (市场环境)
- **真实市场数据**: 支持股票、加密货币等多种资产类型
- **时间序列模拟**: 按日期顺序进行市场环境模拟
- **多因子信息**: 价格、新闻、财报、技术指标等

### 评估管道
- **完整流程**: Warmup → Test → Eval 三阶段评估
- **性能指标**: 收益率、夏普比率、最大回撤、波动率等
- **基准比较**: 与Buy&Hold等策略对比

## 🚀 关键功能特性

### 1. 时间戳目录结构
```
results/YYMMDD_HHMMSS_ModelName_SYMBOL/
├── warmup_checkpoint/    # 预热检查点
├── warmup_output/        # 预热输出
├── test_checkpoint/      # 测试检查点
├── test_output/          # 测试输出
├── final_result/         # 最终结果
├── metrics/              # 性能指标
├── log/                  # 日志文件
├── charts/               # 图表文件
├── report.md            # 专业交易报告
└── trading_results.csv  # 交易数据
```

### 2. 专业交易报告
- **Markdown格式**: 美观的表格和图表展示
- **投资组合表现**: 收益率、年化收益、风险指标
- **交易明细表格**: 详细的买卖决策记录
- **风险分析**: 波动率、夏普比率、最大回撤、VaR
- **基准比较**: 与Buy&Hold策略的Alpha对比
- **可视化图表**: 4种专业图表嵌入

### 3. 数据可视化
- **投资组合价值变化图**: 时间序列收益曲线
- **交易行为分布图**: 买/卖/持有决策统计
- **价格与交易量关系**: 散点图分析
- **阶段性表现对比**: Warmup vs Test阶段

### 4. CSV数据导出
- **完整交易记录**: 时间戳、价格、数量、决策理由
- **投资组合状态**: 每笔交易后的资产状况
- **风险收益指标**: 详细的量化分析数据

## 🔧 技术实现

### API集成
- **OpenAI兼容接口**: 统一的LLM调用接口
- **模型支持**: Qwen、GPT、Claude等主流模型
- **超时处理**: 优雅的API调用错误处理

### 数据处理
- **真实金融数据**: 从JSON文件加载历史市场数据
- **性能计算**: 使用专业的金融指标计算公式
- **风险分析**: VaR、夏普比率、最大回撤等风险度量

### 报告生成
- **自动化报告**: 基于真实投资组合数据生成
- **专业图表**: matplotlib/seaborn生成高质量可视化
- **Markdown表格**: 清晰的数据展示格式

## 🎮 使用方式

### ⚡ 一键运行 (推荐)
```bash
# 快速测试 (2天数据，~5分钟)
python run.py run-all -c configs/quick_test.json

# 标准测试 (4天数据，~10分钟) 
python run.py run-all -c configs/test_clean.json

# 扩展测试 (2周数据，~30分钟)
python run.py run-all -c configs/extended_test.json
```

### 📝 分步运行
```bash
# 完整实验流程 (3步)
python run.py warmup -c configs/test_clean.json
python run.py test -c configs/test_clean.json
python run.py eval -c configs/test_clean.json
```

### 环境要求
```bash
# 启动Qdrant向量数据库
docker run -p 6333:6333 qdrant/qdrant

# 安装依赖
pip install -r requirements.txt
```

### 配置文件
- `configs/test_clean.json`: 清洁的测试配置
- `configs/test_minimal.json`: 原始最小配置
- 支持自定义时间范围、交易标的、模型参数

## 📊 评估指标

### 收益指标
- **绝对收益**: 投资组合价值增长
- **相对收益**: 收益率百分比
- **年化收益**: 按252个交易日标准化
- **Alpha**: 相对基准的超额收益

### 风险指标
- **波动率**: 收益标准差的年化值
- **夏普比率**: 风险调整后的收益
- **最大回撤**: 峰值到谷值的最大跌幅
- **VaR**: 风险价值（95%置信度）

### 交易指标
- **交易频率**: 买卖决策的次数统计
- **胜率**: 盈利交易占比
- **平均持仓期**: 投资决策的时间跨度

## 🔍 项目优势

### 1. 真实性
- 基于真实的金融市场数据
- 专业的金融指标计算方法
- 符合业界标准的评估流程

### 2. 可扩展性
- 支持多种资产类型（股票、加密货币）
- 可配置的智能体参数
- 模块化的评估管道

### 3. 可视化
- 专业的交易报告生成
- 丰富的图表展示
- 清晰的数据表格

### 4. 可重现性
- 完整的实验记录
- 时间戳隔离的结果存储
- 详细的CLI命令参考

## 🛠️ 开发说明

### 关键修复
- **ensure_path()函数**: 修复了删除现有目录的bug
- **API超时处理**: 优化了LLM调用的错误处理
- **数据完整性**: 确保所有阶段都能正确保存输出

### 代码结构
- `src/agent.py`: FinMemAgent核心实现
- `src/env.py`: MarketEnv市场环境
- `src/eval_pipeline.py`: 评估管道和指标计算
- `src/utils.py`: 工具函数和枚举类型
- `run.py`: 主要的CLI入口点

## 📈 示例输出

### 投资组合表现
| 指标 | 数值 | 说明 |
|------|------|------|
| 初始资金 | $100,000.00 | 投资组合起始价值 |
| 最终价值 | $108,631.25 | 投资组合结束价值 |
| 收益率 | 8.63% | 相对收益百分比 |
| 夏普比率 | 1.87 | 优秀 |

### 基准比较
| 基准比较 | 本策略 | Buy & Hold | 差异 |
|----------|---------|------------|------|
| 收益率 | 8.63% | 3.29% | +5.34% |
| 表现 | ✅ 跑赢基准 | 基准策略 | Alpha > 0 |

---

*INVESTOR-BENCH - 专业的LLM投资决策评估框架*